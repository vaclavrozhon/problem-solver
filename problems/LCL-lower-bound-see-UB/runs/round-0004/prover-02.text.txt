{"progress_md":"Status and plan\n- Objective: make the hardness reduction auditable by giving concrete, radius-1 rule schemas for (i) per-bit boundary probes that separate 2^B vertex indices; (ii) per-side color gating and “active/semi-active” seam activation; (iii) a seam gadget that enforces EDGE and Eq with purely local checks, while permitting unconditional acceptance on mixed pairs. We also pin down a small but sufficient symbol budget and a B=2 sanity test template. These address the verifier’s items (1)–(8).\n\nExplicit rule schemas (radius 1) — ready to DP-check on small B\nA. Per-bit boundary probes (Type-Separation TS)\n- Fixed inputs for separation: pick an arbitrary 4-tuple a⋆ ∈ Σ_in^4 (e.g., all zeros). All extendibility bits we use for type separation are E_{w}(a⋆)[·].\n- Tracks encoded in Σ_out (conceptual fields; realized as a finite product alphabet):\n  1) Role ∈ {HEAD, PORT, PAD, PROBE, ERR, …}, Phase ∈ {0,…,c−1} for a small constant c.\n  2) Addr ∈ {⊥,1,…,B}. Present only when Role=PORT. Local neighbor rule enforces Addr increases by +1 left→right across a contiguous PORT zone, starting at 1 and ending at B.\n  3) RIDbit ∈ {0,1}. Cin–out ties RIDbit to Σ_in at nodes with Role=PORT, and otherwise ignores RIDbit (free) unless constrained by Role.\n  4) ProbeHead ∈ {None} ∪ {Start_j, Move_j, Test_j, Accept_j : j∈[B]}. Distinct j are distinct symbols.\n  5) Error/plumbing symbols ERR_• and ⊥ are available globally but will be disabled near ProbeHead≠None during probes.\n- Reserved boundary outputs: define Q_j as the unique 4-tuple of boundary output symbols that set ProbeHead=Start_j at the first interior position (and fix harmless padding on the boundary nodes themselves). Different j use distinct Start_j.\n- Allowed Cout–out neighbor pairs (parametric by j):\n  R1. Start_j → Move_j (the right neighbor carries Move_j; left neighbor is the boundary symbol). No other successor out of Start_j.\n  R2. Move_j may advance only over the pre-laid PROBE corridor and PORT: (Move_j at i, y_{i+1}) is legal iff y_{i+1}.ProbeHead ∈ {Move_j, Test_j} and either (i) y_{i+1}.Role=PORT with Addr incrementing correctly; or (ii) y_{i+1}.Role ∈ {PROBE,PAD} as part of a fixed, finite corridor skeleton that leads into the PORT zone. No ERR or ⊥ adjacent to any Move_j/Test_j (omit such pairs).\n  R3. Move_j → Test_j only when y_{i+1}.Role=PORT and y_{i+1}.Addr=j.\n  R4. Test_j → Accept_j only if y_{i+1}.RIDbit=1 (Cin–out has already tied this bit to the input at that node). Otherwise, Test_j has no legal successor.\n  R5. Accept_j transitions through a short fixed sequence to a neutral PAD filler (a constant-length exit), after which Role=PAD continues with a self-loop language. While ProbeHead∈{Start_j,Move_j,Test_j,Accept_j}, no pairs to ERR_• or ⊥ are allowed; outside probe mode, ERR/⊥ are permitted as usual.\n- PORT-zone well-formedness: local rules enforce a contiguous PORT block with Addr=1,…,B, immediately adjacent to S on the canonical side, as part of the canonical vertex block (see C below). If the probe reaches the end of the allowed corridor without encountering Addr=j (which cannot happen in a well-formed block), there is no legal successor and the DP fails; this guarantees uniqueness.\n- Claim TS (restated precisely). For any canonical left vertex word L(u) with properly formed PORT just to the right of S, E_{L(u)}(a⋆)[Q_j]=1 iff u_j=1; otherwise 0. Proof: under Q_j, the only legal continuation is the deterministic probe path R1–R5; acceptance is equivalent to RIDbit=1 exactly at Addr=j; RIDbit copies the fixed input bit at that node by Cin–out. No error/plumbing escape is permitted in probe mode.\n- Budget for probes: ProbeHead states contribute 4B symbols; Addr contributes B; corridor roles/phases add a constant factor. This induces at most O(B^2) distinct combined symbols in Σ_out when folded. See “Alphabet budget” below.\n\nB. Canonical vertex contexts and per-side color gating (RG)\n- Canonical left block W_L(u): fixed layout HEAD · PORT(B) · RUN · PAD with PORT abutting S on its right; HEAD exposes enc(D) (copied from inputs by Cin–out) and a short delimiter; RUN is a corridor used by the seam tableau (below); PAD is arbitrary filler. Right block W_R(v) is symmetric.\n- Per-side handshake flags next to S: the cell immediately inside S on each side must show a fixed gate token GateL (left context) or GateR (right context), followed (at a fixed offset) by the PORT zone. Cout–out allows S to take a color token {RED, GRN, BLU} only if the adjacent inner neighbor displays the correct Gate• token; otherwise, the only allowed S token is ⊥.\n- Mixed-pair policy (critical correction): seam activity (and any “must-color” constraint) is triggered only when both sides are canonical. If exactly one side is canonical, the canonical side may be colored (per-side gating), the opposite S must be ⊥, and the interior wb∘wc admits only neutral plumbing; no seam tableau is required or even allowed to start.\n\nC. Seam gadget with directional tokens and local acceptance (EDGE, Eq)\n- Goal: enforce, when both sides are canonical, the conjunction\n  (A) EDGE=1 ⇒ colors differ; vacuous if EDGE=0; and\n  (B) Eq=1 ⇒ colors equal; vacuous if Eq=0;\n  while (i) forcing “must-color” in active-active pairs and (ii) guaranteeing unconditional acceptance in mixed pairs.\n- Directional seam tokens: two 1-bit subtracks Tok→ and Tok← that live only on corridor (RUN/PAD) cells across wb∘wc.\n  • If left side is canonical, the inner neighbor of S1 seeds Tok→=1 that deterministically propagates rightwards (Tok→=1 on each successive cell) until it meets S2; Tok→ never turns off.\n  • If right side is canonical, the inner neighbor of S2 seeds Tok←=1 that propagates leftwards analogously.\n- Colored S fallback gating, local and sound:\n  • Near S2: if Tok←=1 is present at the first interior cell (i.e., a token coming from the opposite end), then a colored S2 cannot attach to a neutral neighbor; its only legal successor pairs are to a seam verdict cell (see below). If Tok←=0 locally, a colored S2 may attach to a neutral neighbor (mixed pair fallback). Symmetric rule near S1 using Tok→.\n  • ⊥ at S is locally disallowed when the opposite-direction token is present: if Tok←=1 (respectively Tok→=1) is present adjacent to S2 (resp. S1), then S2=⊥ (resp. S1=⊥) has no legal neighbor pair. This implements must-color only in active-active pairs.\n  These checks are purely local (each S only inspects its interior neighbor’s two Tok bits).\n- Verdict cell and adjacency enforcing (A) and (B):\n  • When both tokens are present anywhere (they overlap throughout the bridge), the seam tableau is permitted and required to run row-by-row across the corridor (standard 1D TM simulation) and eventually place a verdict cell V next to S2 carrying fields EDGE∈{0,1}, Eq∈{0,1}, and FwdColor ∈ {RED,GRN,BLU}, which is a copy of Color(S1).\n  • Cout–out forbids the following pairs between S2 and its interior neighbor when that neighbor is V (verdict):\n    – If EDGE=1 and Color(S2)=FwdColor, forbid (violates inequality on edges).\n    – If Eq=1 and Color(S2)≠FwdColor, forbid (violates same-vertex equality).\n    Conversely, all pairs are allowed if EDGE=0 (for (A)) and if Eq=0 (for (B)). These enforce (A) and (B) simultaneously, using only the S2–V adjacency.\n  • It is legal (but not necessary) for the verdict cell to exist when only one token is present; the tableau cannot complete in that case (no incoming start from the far side), so V never appears. Thus the only viable completion in mixed pairs is via the neutral fallback, which is allowed by the Tok-based gating above.\n- Tableau consistency and robustness: as usual, Cout–out enforces per-row TM transitions across the seam corridor; malformed rows have no accepting continuation. Error-chain alphabets are disabled on RUN/PAD when either color is used at S and a token from the opposite side is present (to avoid escape hatches in active-active mode); they remain enabled in mixed pairs and inactive contexts.\n\nD. Alphabet budget and β sizing (explicit bound)\n- Constant tracks: roles/phases O(1); error alphabet O(1); tableau work alphabet O(1); color/⊥ (4 symbols).\n- O(B) tracks/components:\n  • Addr: B values + ⊥ (for non-PORT cells).\n  • ProbeHead states: 4B distinct states (Start/Move/Test/Accept per j).\n  • Reserved boundary 4-tuples Q_j: B distinct boundary-output choices; these do not multiply Σ_out but require special boundary symbols (O(B)).\n- Tokens and verdict: Tok→, Tok← ∈ {0,1} each (constant factor); verdict fields EDGE, Eq ∈ {0,1}, FwdColor ∈ {R,G,B} (constant factor), realized only on a special verdict role.\n- Folding into Σ_out: the combined symbol set can be organized so that the number of symbols is O(B^2) times a constant (addresses × probe-head id dominate), or O(B^3) if we choose to fully decouple j from head modes and addresses conservatively. With B = s^{c0}, pick β = s^{c1} with c1 ≥ 3c0 to guarantee β ≥ c · B^3 for a fixed c; this leaves ample headroom for all constant factors. This satisfies the “β = poly(s)” requirement.\n\nE. B=2 sanity test template (DP-ready)\n- Choose β ≥ 32. Enumerate symbols for: colors {⊥,R,G,B}; roles {HEAD,PORT,RUN,PAD,PROBE,VERDICT}; Addr ∈ {⊥,1,2}; ProbeHead ∈ {None,Start_1,Move_1,Test_1,Accept_1,Start_2,Move_2,Test_2,Accept_2}; Tok→, Tok← ∈ {0,1}; verdict bits EDGE, Eq ∈ {0,1}, FwdColor ∈ {R,G,B} (verdict role only); error symbols ERR_•.\n- Build four canonical left words L(00), L(01), L(10), L(11) and right words analogously, each with HEAD, a 2-cell PORT zone abutting S, and trivial RUN/PAD. Fix a⋆. Verify with the O(kβ^2) DP that under Q_1 and Q_2, the bits (E_{L(u)}(a⋆)[Q_1], E_{L(u)}(a⋆)[Q_2]) equal u.\n- Instantiate a toy D on 4 vertices (e.g., a 4-cycle), encode it into HEAD, and run the DP on all 16 ordered pairs (L(u), R(v)). Check: if D(u,v)=1, the only completions for active-active pairs have unequal colors (enforced by S2–V pairs); if D(u,v)=0, all color pairs accept; if u=v, Eq=1 forces equal colors. Mixed pairs accept unconditionally with the colored canonical side and ⊥ on the inactive side.\n\nWhy the token-gated seam resolves the locality issues\n- Mixed pairs accept locally: if only one side is canonical, the opposite-direction token is absent locally. Thus colored S can attach to neutral neighbor states without requiring a verdict, and ⊥ is allowed as well.\n- Active-active pairs force constraints locally: both tokens are present adjacent to both S’s. Locally (at each S), ⊥ is disallowed (must-color), and colored S cannot attach to neutral neighbors; it must attach to a verdict cell. The verdict cell enforces (A) and (B) via S2–V local pairs. No reference to distant nodes is needed.\n- No error escape: in probe mode and in seam-active modes (when opposite-direction token is present), ERR/⊥ transitions are disabled in Cout–out; malformed attempts dead-end.\n\nSoundness/completeness recapped with Eq\n- Completeness: Given a 3-coloring χ on V={0,1}^B, set f(Type(L(u)))=χ(u), f(Type(R(v)))=χ(v), f(τ)=⊥ for all inactive τ. Active-active pairs: both tokens present; the tableau computes EDGE and Eq; the verdict adjacency enforces S-color inequality on edges and equality on u=v; mixed pairs: exactly one token near S; fallback acceptance ensures feasibility. Must-color is enforced automatically on active-active pairs by token rules.\n- Soundness: If f passes (F1), the token-gated must-color forces f to assign non-⊥ to canonical types. Define χ(u)=f(Type(L(u))). The (L(u),R(v)) bridge (with both tokens) enforces χ(u)≠χ(v) for edges and χ(u)=χ(u) trivially for same-vertex pairs; thus χ is a proper 3-coloring.\n\nGaps/risks and how we addressed them\n- Unique probe continuation (verifier item 6): enforced by forbidding ERR/⊥ next to ProbeHead and by making Start_j/Move_j/Test_j deterministic with a single successor per state; the corridor layout ensures the head must reach the unique Addr=j cell or die.\n- Mixed-pair acceptance (items 1–2): resolved by per-side gating and directional tokens; only the presence of the opposite-direction token disables fallback and ⊥ locally.\n- “Must-color” only in active-active: enforced by forbidding S=⊥ locally when the opposite-direction token is present.\n- Seam wiring locality (item 7): acceptance checks occur only between S2 and the verdict cell V (and symmetrically S1/its verdict if desired); EDGE/Eq and FwdColor are carried in V. No distant inspection.\n- Alphabet budgeting (item 8): explicit O(B^2)–O(B^3) bound and β sizing provided.\n- Length normalization: existence of canonical contexts with PORT abutting S at |w_i|∈{ℓ_pump,ℓ_pump+1} still relies on pumping/replacement. We keep this as an assumption in notes; integrating Lemmas 11,14–15 into output.md remains a to-do if needed.\n\nMinor clarifications for output.md (new)\n- Types vs. fixed interior inputs: please add a parenthetical “types E_w(a) are computed with respect to the fixed input string of w” (we rely on Cin–out tying RIDbit to inputs in PORT).\n- Context set C: it helps to state explicitly that C consists of types of words w_1 S w_2 with |w_i|∈{ℓ_pump,ℓ_pump+1} and |S|=2; this keeps C finite with |C|≤ℓ_pump.\n\nNext concrete steps (auditable)\n1) Produce a B=2 machine-readable instance (symbol list and Cin–out/Cout–out fragments) reflecting A–C above and run the verifier’s O(kβ^2) DP for the TS probe and seam pairs.\n2) Write the exact Cout–out pair schemas (parametric) used above: Start_j→Move_j→Test_j→Accept_j; token propagation; S/neighbor forbidden pairs; verdict adjacency.\n3) Optional: formalize the existence of canonical contexts at |w|∈{ℓ_pump,ℓ_pump+1} using Lemmas 11,14–15 (replacement/pumping) and add a short lemma to output.md.\n4) Integrate Lemma TS (per-bit probe), Lemma RG (per-side gating and token must-color), and Lemma SG (seam tableau with EDGE/Eq and local acceptance) into the curated output once the B=2 validation passes.\n\nWhy this is progress\n- We’ve transformed the sketches into precise, local rule families that a DP can check: deterministic probe pipelines for type separation; per-side gating plus directional tokens to reconcile mixed-pair acceptance with active-active constraints; and a strictly local verdict interface encoding both EDGE and Eq. The symbol budget is explicit and stays within β=poly(s). This addresses all previously flagged locality, determinism, and mixed-pair issues and sets up a small-scale DP regression to validate behavior end-to-end."}