{"progress_md":"Round 0005 — Parametric, radius-1 rule schemas you can DP-check; adopting directional tokens\n\nContext and objective\n- We adopt the verifier’s recommendation to use directional tokens for seam activation. This round supplies explicit, radius-1 Cout–out (and the relevant Cin–out) rule schemas that are ready to be instantiated (especially for B=2) and verified by the O(kβ^2) DP. We also give a short, specialized padding lemma (radius 1) to justify canonical contexts at lengths in {ℓ_pump, ℓ_pump+1} without changing near-S behavior.\n\nA. Per-bit probe: explicit local rules (Type-Separation TS)\nSymbols/tracks (folded into Σ_out; disjoint role subalphabets so sizes add):\n- Boundary outputs: for each j∈[B], four reserved tokens Q^L1_j, Q^L2_j, Q^R2_j, Q^R1_j. All non-reserved boundary outputs are ordinary tokens Bnd•.\n- PORT zone (adjacent to S on canonical left): Port^I(k,b) and Port^P(k,b) for k∈[B], b∈{0,1}. Port^I used in idle, Port^P in probe mode; both carry (Role=PORT, Addr=k, RIDbit=b).\n- Probe states per j: Start_j, Head_j, Test_j, Accept_j (Role=PROBE). No other role has ProbeHead≠None.\nCin–out constraints:\n- When Role=PORT, RIDbit equals the node’s input bit; otherwise unrestricted.\nCout–out pairs (all omitted pairs are illegal):\n- Boundary injection (reserved probes only): (Q^L1_j, Q^L2_j) and (Q^L2_j, Start_j). No other successor from Q^L2_j.\n- Corridor marching to PORT[1]: (Start_j, Head_j). For any non-PORT corridor cell y, (Head_j_prev, Head_j_y). No pairs from Head_j to ERR/⊥ (disables escape).\n- Entering PORT and scan-by-address:\n  • For any k,b: (Head_j_prev, Port^P(k,b)).\n  • If k≠j: (Port^P(k,b), Head_j_next) (head keeps moving).\n  • If k=j and b=1: (Port^P(j,1), Test_j), then (Test_j, Accept_j). If k=j and b=0: Test_j has no legal successor (dead-end). No (Test_j,•) except (Test_j,Accept_j).\n- Accept exit to PAD: (Accept_j, PAD), and then PAD self-loops.\n- Mode exclusivity: Any adjacency involving Start_j/Head_j/Test_j/Accept_j appears only under Q_j; there are no pairs from PAD/HEAD/PORT^I into any PROBE state. Thus PROBE states cannot spontaneously appear unless Q_j is used.\n- PORT contiguity/monotonicity (independent of probes): For consecutive PORT cells x→y, allowed pairs enforce Addr(x)+1=Addr(y), starting at Addr=1 and ending at Addr=B. This makes a contiguous block abutting S; non-PORT intrusions in between have no legal pairs with PORT neighbors.\nClaim TS (restated, DP-checkable): For canonical L(u) with a well-formed contiguous PORT zone at S, and fixed boundary inputs a⋆, the DP on the 4-node boundary with outputs Q_j accepts iff u_j=1, hence E_{L(u)}(a⋆)[Q_j]=u_j. Determinism comes from unique successors and the prohibition of ERR/⊥ near PROBE.\n\nB. Per-side color gating and seam activation with directional tokens\nSymbols/tracks:\n- S-color tokens at the two S nodes: S_⊥, S_R, S_G, S_B.\n- Gate tokens adjacent to S inside canonical blocks: GateL on left interior neighbor of S1; GateR on right interior neighbor of S2.\n- Corridor roles across the bridge wb∘wc: RUN, PAD, VERD (verdict cell role). Each corridor symbol encodes Tok→,Tok←∈{0,1} (two bits) used only on corridor roles.\nLocal gating at S (Cout–out pairs touching S and its interior neighbor):\n- Permission: If neighbor is GateL (resp. GateR), allow S∈{S_R,S_G,S_B,S_⊥} on that side; else only S_⊥ allowed. This is per-side, independent.\nDirectional token seeding (purely local):\n- If the interior neighbor is GateL and S1∈{S_R,S_G,S_B}, then the immediate corridor cell to the right of S1 must have Tok→=1; otherwise Tok→=0.\n- If the interior neighbor is GateR and S2∈{S_R,S_G,S_B}, then the immediate corridor cell to the left of S2 must have Tok←=1; otherwise Tok←=0.\nToken propagation (deterministic):\n- For any corridor edge x→y, allowed iff Tok→(y) ≥ Tok→(x) and Tok←(y) ≥ Tok←(x), and once a token bit becomes 1 it stays 1 across the entire bridge (monotone propagation). Concretely, list the four allowed bit-pairs per edge: (0,0)→(0,0), (1,0)→(1,0), (0,1)→(0,1), (1,1)→(1,1). Disallow any decrease.\nMust-color and mixed-pair fallback (local checks at S):\n- If the interior neighbor’s Tok bit from the opposite side is 1 (Tok→ at S1’s neighbor; Tok← at S2’s), then the only allowed S tokens are S_R,S_G,S_B (forbid S_⊥). Also, in this case S must attach to a non-PAD verdict/corridor neighbor (see C below); attaching to neutral PAD is forbidden. If the opposite token bit is 0, both S_⊥ and S_{R,G,B} are allowed and may attach to PAD neighbors (mixed/inactive acceptance).\nRemark: These three rules ensure: (i) only canonical sides can choose colors; (ii) must-color is enforced only in active-active (both tokens present); and (iii) mixed pairs accept via PAD-only plumbing.\n\nC. RUN tableau and verdict cell with local EDGE/Eq gate\nVerdict neighbor format:\n- The cell immediately to the right of S2 (inside the corridor) takes a role VERD(e,q,c) with e=EDGE∈{0,1}, q=Eq∈{0,1}, and c=FwdColor∈{R,G,B}. A 1-bit forwarder track copies S1’s color along the corridor; pairwise neighbor equalities enforce consistency until VERD.\nLocal acceptance at S2↔VERD (enumerable finite list):\n- Allowed pairs (S2, VERD(e,q,c)) exactly when both constraints hold:\n  • If e=1, then S2’s color ≠ c; else (e=0) no restriction.\n  • If q=1, then S2’s color = c; else (q=0) no restriction.\n- Concretely: for e=0,q=0 allow all 3×3 color pairs; e=1,q=0 allow all unequal pairs; e=0,q=1 allow only (S2=c); e=1,q=1 allow none (this case should be unreachable if D(u,u)=0; if it occurs due to a malformed tableau, the instance correctly dead-ends).\nRUN corridor robustness and activation:\n- When both Tok→=Tok←=1 (active-active), Cout–out permits only RUN/VERD states (no ERR/⊥) and requires a well-formed row-by-row simulation of U that reads (enc(D), u, v). Any malformed step has no legal continuation (local refutation). When at least one token is 0, RUN/VERD symbols are disallowed and PAD plumbing is allowed.\n\nD. B=2 auditable micro-instance (symbol list and key pairs)\nSymbols (minimal set):\n- S: S_⊥, S_R, S_G, S_B.\n- PORT (left): Port^I(1,0/1), Port^I(2,0/1), Port^P(1,0/1), Port^P(2,0/1).\n- Probe: Start_1, Head_1, Test_1, Accept_1; Start_2, Head_2, Test_2, Accept_2.\n- Boundary: Q^L1_1,Q^L2_1,Q^R2_1,Q^R1_1 and same for j=2; also generic Bnd• tokens.\n- Gate: GateL, GateR.\n- Corridor: PAD_00, PAD_10, PAD_01, PAD_11 (PAD with Tok→Tok← bits), and VERD(c∈{R,G,B}, e∈{0,1}, q∈{0,1}); RUN_x (finite work alphabet, omitted here but locally checked).\nKey Cout–out pairs (subsample; full set by schemas A–C):\n- Probes: (Q^L2_1, Start_1), (Start_1, Head_1), (Head_1, Port^P(1,b)), (Port^P(1,1), Test_1), (Test_1, Accept_1), (Accept_1, PAD_00), (Head_1, Port^P(2,b)), (Port^P(2,b), Head_1). Mirror for j=2.\n- PORT contiguity: (Port^I(1,•), Port^I(2,•)) allowed; (Port^I(2,•), non-PORT) terminates block; no other cross.\n- Gating at S1: (GateL, S_{R/G/B/⊥}) allowed; (non-GateL, S_⊥) only. Similarly for S2 and GateR.\n- Token seeding/propagation: From GateL with S1∈{R,G,B} require the right neighbor be PAD/RUN with Tok→=1; else Tok→=0. Along corridor, (PAD_ab, PAD_ab) and (PAD_a b, PAD_a b) with nondecreasing bits as above.\n- Must-color: If the cell next to S2 has Tok←=1, forbid (S_⊥, •) and forbid attachment to bare PAD; require the neighbor be VERD or a RUN boundary state. If Tok←=0, allow (S_any, PAD_•0) freely.\n- Verdict: enumerate allowed (S2_color, VERD(e,q,c)) as per C.\nDP audit steps:\n1) Build L(00), L(01), L(10), L(11) with a length-2 PORT zone abutting S and seed HEAD/PAD elsewhere. Fix a⋆. Verify E_{L(u)}(a⋆)[Q_1]=u_1 and E_{L(u)}(a⋆)[Q_2]=u_2.\n2) Define a toy D on 4 vertices (00–01–11–10–00). Implement U as a constant table writing VERD(e,q,c) with q=1 iff u=v and e=1 on edges. For all 16 ordered pairs (L(u),R(v)): active-active accepts iff [(edge ⇒ colors differ) ∧ (u=v ⇒ colors equal)]. Mixed pairs (exactly one Gate) accept for any color on the canonical side and ⊥ on the other.\n\nE. Padding lemma for canonical contexts (radius 1, specialized)\nLemma Pad (explicit). Fix any finite “near-S” pattern W (HEAD·PORT(B)·RUN), and a PAD filler P (Role=PAD) whose Type(P^t) stabilizes by t≥t0 (exists by Lemma 15). For each large ℓ∈{ℓ_pump, ℓ_pump+1}, there exists t such that |P^t·W|=ℓ and Type(P^t·W) depends only on Type(W) (independent of t once t≥t0). Moreover, since PAD never uses PROBE/RUN/PORT roles, the probe/seam interfaces at S are unchanged.\nProof sketch: By periodicity of Type(P^t) and replacement (Lemma 11), increasing t beyond t0 does not change Type(P^t·W). Adjust t by at most 1 to hit the desired length. Apply symmetrically on the right. Hence canonical contexts with PORT abutting S exist at both target lengths without altering the gadgets.\n\nF. Budget and locality recap (for the tables you will instantiate)\n- Disjoint role subalphabets (S, PORT, PROBE, GATE, PAD, RUN, VERD, BOUNDARY) prevent unintended cross-products; sizes add. Dominant counts: O(B) PORT symbols (both I/P variants) and O(B) probe states. Adjacency table has O(B^2) nonzeros from (Head_j↔Port^P(k,•)) and a constant number elsewhere. Choose β ≥ c·B^2.\n\nGaps/clarifications in output.md\n- None critical remain; output.md already states the “fixed interior inputs” interpretation parenthetically in Definitions. You may consider adding a short note that C (context types) is realized by w_1 S w_2 with |w_i|∈{ℓ_pump,ℓ_pump+1}, hence |C|≤ℓ_pump (used implicitly in our verifier loops).\n\nNext steps (auditable)\n1) Instantiate the above schemas for B=2: provide the full Cin–out mask (RIDbit copy) and the complete Cout–out table fragment covering A–D.\n2) Run the O(kβ^2) DP to validate TS and the seam behavior on all 16 pairs; include traces for any failing pair (none expected).\n3) Generalize the B=2 tables parametrically to arbitrary B (the only growth is in the families {Port^•(k,·)} and {Start/Head/Test/Accept}_j and {Q}_j).\n4) Incorporate Lemma Pad (E) into output.md as a short lemma once the DP confirms behavior.\n5) Package the S3Col→FFE(F1) reduction with these gadgets; ensure ⊥-plumbing makes (F2) vacuous, concluding NEXPTIME-hardness of the 3-way classifier in this explicit model."}