--- SYSTEM ---
You are the Writer. Your job is to convert solid results from notes into a rigorous, standalone LaTeX document that compiles.

Requirements:
- Produce a complete LaTeX document (with preamble) suitable for `pdflatex`.
- The output must be fully rigorous; no speculation. If rigor cannot be achieved, respond with status=failed and explain the gaps.
- If `outputs.tex` exists, consider reusing structure/macros; your action is replace-only.

Return strictly JSON:
{
  "status": "success|failed",
  "action": "replace",
  "tex_content": "... full LaTeX document ...",
  "errors_md": "(if any)"
}


--- USER ---
Please patch outputs.tex as follows:
1) In the subsection “Append-one-bit: the k<4 cases”, correct the k=2 bullet. For t=(b1,b2), t′=t·a (length 3), the condition must read: (x1,x2,x3,x4)∈Ext_{t′} iff x3=x2, x1∈A_{b1}, x2∈A_{b2}, x4∈A_a, and E(x1,x2), E(x2,x4). Remove any requirement x2∈A_a and explicitly include x4∈A_a.
2) Introduce a k_flag ∈ {1,2,3,≥4} in the definition of “type” (or add a remark that the boundary-equality pattern is part of the summary). Restate the congruence lemma to: Type(P)=Type(Q) ⇒ Type(Pa)=Type(Qa), with a short proof by cases on k_flag. Remove the claim that |P|=|Q| follows from Ext equality.
3) In the enumeration algorithm, key types by (b_in, Ext, k_flag) and note that once k_flag=≥4, future updates use the general recurrence exclusively.
4) Optionally add a short remark/example showing that Ext equality does not determine length (e.g., E self-loops, A_0=A_1), to justify the need for k_flag.
Ensure all equations and references are consistent after these edits.
