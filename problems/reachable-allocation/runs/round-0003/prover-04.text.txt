# Ideas

- Strengthen and formalize the NP-membership argument for TREE-REACHABLE-PE with explicit verification routines and complexity bounds. Add a precise “PO implies sink” lemma (any globally PO matching has no allowed swap), which narrows the search to reachable sinks.
- Correct a flaw in earlier notes: treewidth as a parameter is not useful here because every tree has treewidth 1, and the DP’s state must nevertheless carry global object-usage information; so an FPT claim by treewidth in the usual sense is misleading. We propose alternative parameters in the next steps.
- Provide a clean, auditable NO-instance on a path/star showing that a locally stable (no allowed swap) matching can be globally Pareto-dominated. This motivates the need to explicitly test PO at sinks.
- Record two safe, one-sided polynomial procedures: (i) TTC-as-certificate (if TTC is reachable, return it); (ii) sink-test (compute any reachable sink by greedy swaps, then PO-check it). Both yield constructive YES-witnesses when they succeed.

# Rigorous facts and proofs

Lemma 1 (Reachable ⇒ IR). Let T=(V,E) be a tree, preferences strict, and µ0 the initial endowment. If µ is reachable from µ0 by a finite sequence of allowed swaps along edges, then for every agent a, µ(a) ≽_a µ0(a).

Proof. Each allowed swap strictly improves the two participants and leaves all others unchanged. Along the sequence, an agent’s object changes only when she participates, and then it strictly improves. Hence relative to µ0, each agent weakly improves. ∎

Lemma 2 (PO implies sink). If a matching µ has an allowed swap on some edge {u,w}, then µ is not globally Pareto-efficient. Equivalently, any globally PO matching has no allowed swap (is a sink).

Proof. If {u,w} is allowed at µ, swapping strictly improves u and w and leaves all other agents unchanged. The resulting matching Pareto-dominates µ, contradicting global PO. ∎

Lemma 3 (Polynomial-time PO test). Given a matching µ, we can decide in O(n^2) whether µ is globally Pareto-efficient.

Proof. Build the standard improvement digraph G_µ on vertices A∪B: add arc a→b for each object b with b ≻_a µ(a); add arc b→a where a=µ^{-1}(b). Then µ is PO iff G_µ has no directed cycle. If a directed cycle exists, it yields a cyclic reassignment strictly improving the involved agents; conversely, if no cycle exists, no coalition can strictly improve all its members (this is the classic Shapley–Scarf/TTC characterization). Cycle detection takes O(n^2). ∎

Lemma 4 (Tree target-reachability in O(n^2)). Given initial matching µ0 and target matching µ on a tree, we can decide in O(n^2) whether µ is reachable by allowed swaps, and if yes, produce a sequence.

Proof sketch (good-edge scheduler). Fix each agent’s dipath from its current object to its target object on the tree. Call an edge e good if the two agents at its ends both need to cross e next along their dipaths. If µ is reachable and differs from the current matching, some good edge exists. Swapping on any good edge preserves goodness of other edges and creates at most two new good edges. Iteratively swap on arbitrary good edges until either µ is reached or no good edge remains. Precomputing initial good edges and the incremental updates yields O(n^2) total time. (This is the object-moving analogue of Gourvès–Lesca–Wilczynski, Proposition 3; see also the proof sketch replicated in the provided reference.) ∎

Theorem 5 (TREE-REACHABLE-PE ∈ NP). Given an instance (T, µ0, ≻), the certificate is a target matching µ*. Verification is polynomial: (i) check that µ* is globally PO via Lemma 3 (O(n^2)); (ii) check that µ* is reachable from µ0 via Lemma 4 (O(n^2)). ∎

Corollary 6 (Search restricted to sinks). TREE-REACHABLE-PE answers YES iff there exists a reachable sink matching that is globally PO.

Proof. By Lemma 2, any globally PO matching is a sink. Conversely, any reachable sink that is PO is a valid witness. ∎

Remark (One-sided polynomial certificates). TTC-as-certificate: TTC is globally PO; if it is reachable (Lemma 4), return it and a swap sequence. Sink-test: compute any sink by greedily performing allowed swaps until none remain (termination in ≤O(n^2) swaps), then PO-test it (Lemma 3). Both procedures run in polytime and produce constructive witnesses when they succeed; neither is complete on trees.

# Examples

Example 1 (NO-instance on a path/star). Path A–B–C with initial (A:a,B:b,C:c) and preferences A: b ≻ a ≻ c; B: c ≻ b ≻ a; C: a ≻ c ≻ b. No swap is allowed initially (on AB, B would get a it dislikes; on BC, C would get b it dislikes). The 3-cycle allocation (A:b,B:c,C:a) Pareto-dominates the initial matching; hence no reachable matching is globally PO. The same instance with B as a star center and A,C leaves exhibits a locally stable but globally dominated initial matching.

# Corrections to notes

- Treewidth-FPT caveat. Every tree has treewidth 1, but a DP that enumerates perfect matchings must record global object usage across separators, so the state space is not bounded solely by treewidth. Thus the earlier “FPT by treewidth” outline (storing partial injections in bags) does not yield a practical polytime algorithm on trees; it remains an exponential-time scheme. A different parameter (e.g., number of agents with long-range aspirations, or maximum degree Δ together with bounded preference structure) is needed for genuine FPT progress.

# Obstacles

- Sinks are necessary but not sufficient; there can be multiple reachable sinks and some are not globally PO (Example 1 shows a sink that is globally dominated by an unreachable cycle). Exhaustively enumerating reachable sinks seems exponential in general.
- The earlier order-independence/unique-sink claim for stars was based on agent-moving dynamics and does not directly apply to the object-moving model we study; on stars in object-moving, the center agent stays put while its object changes, and leaves can swap multiple times, so confluence is unclear. We refrain from asserting uniqueness.

# Next steps

1) Parameter search. Replace treewidth with parameters that actually control state complexity on trees (e.g., number of branch vertices with degree≥3 together with bounds on how many agents rank nonlocal objects above endowment). Try to prove FPT in such parameters.
2) Double-star (two centers connected by one bridge) case. Formalize a “bridge-token” invariant: the only cross-component movement is via the u–v edge, and the center objects evolve along strictly improving chains for the two center agents. Enumerate O(n) patterns of bridge crossings and, between crossings, locally saturate leaf swaps. Then PO-test the resulting sinks. We will deliver a full proof and time bound next.
3) Catalog small trees (n≤6) to count reachable sinks and PO status. Aim to extract structural lemmas constraining sinks on trees (e.g., constraints on improvement cycles in the improvement-digraph at sinks) that may prune the search.
4) Strengthen TTC-as-certificate: characterize when TTC is tree-reachable (necessary and sufficient local conditions on the tree), to enlarge the polynomially decidable YES-region.

# Summary deliverables for proofs.md

- Lemma 1 (Reachable ⇒ IR) with proof.
- Lemma 2 (PO implies sink) with proof.
- Lemma 3 (Polynomial PO test via improvement-digraph) with proof.
- Lemma 4 (Tree target-reachability in O(n^2)) with proof sketch and citation to Gourvès–Lesca–Wilczynski.
- Theorem 5 (NP membership) with verification complexity.
- Corollary 6 (Reduction to sinks) and Example 1 as a certified NO-instance.

These pieces are self-contained and support the NP placement and two practical one-sided polynomial certificates, while correcting the treewidth DP misstatement and setting up the next round’s double-star analysis.