=== SYSTEM ===
You are a research **summarizer**. Summarize this *last round only* for a human log.

Include:
- 3–7 bullet **Highlights** (facts learned, reductions, counterexamples, partial bounds).
- 1–3 **Open questions / TODOs** for the next round.
- 1–3 **Citations to files** you relied on (e.g. round files or papers by name).

**Return strictly JSON**:
{
  "summary_md": "Readable summary of the round (≤200 words)",
  "one_line_summary": "Brief one-line summary for UI display (≤100 chars)",
  "highlights": [],
  "next_questions": []
}

=== USER ===
=== Task (txt) ===

# Permutation UB-vs-OPT Separation Problem

**Universe.** Keys are $[n]=\{1,2,\dots,n\}$ with the usual order.
An **instance** is a permutation $\pi=(x_1,\dots,x_n)$ of $[n]$.

## 1) Unified-bound cost on a permutation

For each time $i\in\{1,\dots,n\}$:

* Let $R_i(1),R_i(2),\dots,R_i(i-1)$ be the previously accessed keys ordered by **recency** (so $R_i(1)=x_{i-1}$, $R_i(2)=x_{i-2}$, …).
* Define the **rank distance** $\Delta_i(j) := |\,x_i - R_i(j)\,|$.
* The **per-access unified charge** is

  $$
  \mathrm{UB}_i(\pi)\;:=\;\log\!\Big(1+\min_{1\le j\le i-1}\big(j+\Delta_i(j)\big)\Big),
  $$

  with the convention $\mathrm{UB}_1(\pi):=\log(1+n)$.

The **total unified-bound cost** is

$$
\mathrm{UB}(\pi):=\sum_{i=1}^n \mathrm{UB}_i(\pi).
$$

*(Remarks: logs are base 2; constants are irrelevant for asymptotics. Because $\pi$ is a permutation, “working-set number” equals the recency rank $j$, so this is the standard unified bound specialized to permutations.)*

## 2) Optimal dynamic BST cost on a permutation

We use the standard **dynamic BST model**:

* The algorithm maintains a binary search tree $T$ over $[n]$.
* To access $x_i$, it traverses parent/child pointers from the root to $x_i$; pointer moves and comparisons along the search path each cost 1.
* After (or during) the access, it may perform any number of **rotations**, each costing 1.
* The initial tree is a fixed balanced BST on $[n]$. (Allowing an arbitrary offline choice changes costs by at most an additive $O(n)$ and doesn’t affect asymptotics for this problem.)

For a permutation $\pi$, the **cost of an algorithm $\mathcal A$** is the sum of search-path lengths plus rotations over the $n$ accesses. The **optimal BST cost** is

$$
\mathrm{OPT}_{\mathrm{BST}}(\pi):=\min_{\mathcal A}\;\text{cost}_{\mathcal A}(\pi).
$$

## 3) The separation task

Find an infinite family of permutations $\{\pi_n\}_{n=1}^\infty$, $\pi_n\in S_n$, such that

$$
\mathrm{OPT}_{\mathrm{BST}}(\pi_n)\;=\;o\!\big(\mathrm{UB}(\pi_n)\big)
\quad\text{as }n\to\infty.
$$

A **strong separation** would meet, for some constants $c,C>0$,

$$
\mathrm{OPT}_{\mathrm{BST}}(\pi_n)\;\le\; C n
\qquad\text{and}\qquad
\mathrm{UB}(\pi_n)\;\ge\; c\,n\log n,
$$

i.e., $ \mathrm{OPT}_{\mathrm{BST}}(\pi_n) / \mathrm{UB}(\pi_n) = O(1/\log n)$.

*(Equivalently, in per-access terms: find $\pi_n$ with average BST cost $o(1)\cdot$UB’s average, e.g. $O(1)$ vs $\Omega(\log n)$.)*




=== Notes ===

# Research Notes



# Corrections and guidance

- Bit-reversal UB lower bound (Prover 1): The argument via t = ν2(i−1) shows UB_i ≥ log(min{2^t, 2^{h−t−1}}) = min{t, h−t−1} − O(1). With Pr[t=k]=2^{−(k+1)}, we have E[min{t,h−t−1}] = ∑_{k=0}^{h−1} 2^{−(k+1)} min{k, h−k−1} = O(1). Therefore this line of reasoning yields only UB(π) = Ω(n), not Ω(n log n). The step claiming Θ(h) per step is incorrect.

- DFS UB = Θ(n) (Prover 1): The sketch using UB_i ≤ log(2 + |x_i − x_{i−1}|) is plausible but needs a clean proof. Suggested route: charge log differences to subtree sizes along the DFS traversal and show ∑_v O(log size(v)) = O(n).

- Round-robin block construction (Prover 2): The per-step lower bound min_j (j + |x_i − x_{i−j}|) ≥ ⌊b/2⌋ for all i beyond the first round is false. Counterexample pattern (general b): choose within-block σ_b with (c_2, c_3) = (1, b). For any block B_r at round t=3, let s be the adjacent block that comes after r in ρ_k. Then the last access to B_s was at round t=2 with key c_2=1, so Δ = b + c_2 − c_3 = 1. The corresponding j equals k + pos(r) − pos(s) − 1 ≤ k−1, hence j + Δ ≤ k. When k ≪ b, this is < b/2, contradicting the claimed bound. In fact, many t produce such small witnesses, so UB_i can be O(log k) frequently.

- Fractal 2413 family (Prover 1): BST side is promising if we can cite or prove that Greedy runs in O(n) on permutations whose substitution decomposition uses only simple nodes of size ≤ 4. The UB lower bound must be scale-based: for many i, show that all candidates among the last L (for L ≈ the size of a relevant block scale) are far in key, so min_j (j+Δ) = Ω(L), giving UB_i = Ω(log L). The naive “first-arrival per block” charge yields only O(n) total and is insufficient.

- Next steps:
  1) Provide a rigorous DFS UB=O(n) proof or a citation.
  2) Correct the bit-reversal UB claim; add numerical UB for n = 2^h up to h ≈ 14–16.
  3) For F_h, (a) verify/cite Greedy’s O(n) bound for k-decomposable (k=4), (b) develop and prove a proper scale-based UB lower bound, and (c) compute UB empirically for h up to 8–10.
  4) Abandon the round-robin block family for UB ≈ n log(n/k); its structure lets adjacent-block, previous-round witnesses keep UB_i = O(log k) too often.


New candidate family and fix to UB lower bound

- Adopt the recursively interleaved 2413-inflation family π_h on n=4^h keys with the midpoint-first constraint: at every interval J of size 4^t, the first key emitted by F_t(J) is the midpoint m(J); and at each node, the time order of children is 2,4,1,3.
- UB lower bound strategy: charge only at child-boundary steps within each node’s restricted sequence (S2→S4, S4→S1, S1→S3). At the first key of a child, all previous accesses are outside that child; the midpoint ensures a rank-distance ≥ s_v/8 to any earlier key, where s_v is the parent interval size. Thus UB_i ≥ log(1 + s_v/8) at those steps.
- Counting without double counting: each consecutive pair (x_{i−1}, x_i) has a unique lowest common ancestor v in the 4-ary decomposition tree; this pair coincides with exactly one such boundary at v. Hence the boundary times over all nodes are disjoint and total n−1.
- Summing over nodes gives UB(π_h) ≥ Θ(n log n); the trivial UB ≤ n log n yields UB(π_h) = Θ(n log n).
- BST side: choose a static reference BST that recursively splits {I1∪I2} vs {I3∪I4}. At each decomposition node, the restricted sequence is L,R,L,R, so exactly 3 alternations. Filling contiguous intervals into a full BST contributes O(1) alternations per filler node. Hence Wilber-1 = O(n). Tango yields an explicit algorithm with cost O(n log log n).
- Correction: The earlier per-level event argument (choosing t in the first quarter of D and claiming t−j lies in B for j ≤ s) is false; those t−j remain in D. The boundary/LCA charging avoids this pitfall.
- Next: formalize the LCA-based bijection and the filler-node alternation accounting; attempt to improve OPT to O(n) (Greedy or tailored BST).


=== Current Output ===

# Main Results



Result: An explicit permutation family with UB = Θ(n log n) and OPT_BST ≤ O(n log log n)

Setup
- Let n = 4^h. Define a permutation π_h by recursively partitioning [1..n] into four equal contiguous key blocks I1<I2<I3<I4. The time order at each node is 2,4,1,3 (2413 inflation). Impose the midpoint-first constraint: for every interval J of size 4^t, the first key emitted by its subsequence is the midpoint m(J).

Unified-bound lower bound
- For an internal node v with interval size s_v, at the time i when the sequence first enters a child block within v (i.e., at boundaries S2→S4, S4→S1, S1→S3), the accessed key x_i is the midpoint of that child. No earlier access lies in that child, hence every earlier key y is outside it. The midpoint is at rank-distance ≥ s_v/8 from any such y. Therefore UB_i ≥ log(1 + s_v/8).
- Each pair of consecutive accesses (x_{i−1}, x_i) has a unique lowest common ancestor v in the 4-ary decomposition tree; within v’s restricted sequence this pair occurs at one of the three child-boundaries. These boundary indices over all v are pairwise distinct and total n−1.
- Summing UB_i over these n−1 indices yields ∑_v 3·log(1 + s_v/8). There are 4^ℓ nodes at level ℓ with s_v = 4^{h−ℓ}; thus the sum is Θ(∑_{ℓ=0}^{h−1} 4^ℓ (h−ℓ)) = Θ(n log n). Since trivially UB(π_h) ≤ n log(1+n), we conclude UB(π_h) = Θ(n log n).

BST upper bound
- Fix a static reference BST T_ref that, at each node of the decomposition, splits keys into L := I1∪I2 and R := I3∪I4 and recurses; fill contiguous subintervals arbitrarily to form a full BST. For any decomposition node, the restricted sequence visits L and R in the pattern L,R,L,R, so exactly 3 alternations occur at that partition. Filler nodes on contiguous intervals contribute at most one alternation each. Hence Wilber-1(T_ref, π_h) = O(n).
- Tango trees achieve cost O(W_1 · log log n) against any fixed reference tree. Therefore there is an explicit BST algorithm with total cost O(n log log n) on π_h, implying OPT_BST(π_h) ≤ O(n log log n).

Conclusion
- The family {π_h} yields UB(π_h) = Θ(n log n) while OPT_BST(π_h) ≤ O(n log log n). Consequently OPT_BST(π_h) / UB(π_h) = O(log log n / log n) = o(1), providing the requested separation (not yet the strongest O(n) vs Ω(n log n)).


=== Verifier Summary ===

Prover 1 corrected bit-reversal to UB=Ω(n) but proposed a flawed UB(F_h) proof via per-level events; that approach must be dropped. Prover 2 introduced a 2413-inflation family with a midpoint-first constraint and gave a correct UB lower bound by charging only at child-boundaries: UB(π_h)=Θ(n log n). On the BST side, a tailored static reference tree yields Wilber-1 = O(n), so Tango achieves O(n log log n), giving OPT/UB = o(1). We can now formalize proofs to resolve the separation (non-strong). Next: finalize rigorous proofs (boundary/LCA mapping; W1 bound incl. filler nodes) and explore whether OPT can be improved to O(n) for a strong separation.


=== Current Notes ===

# Research Notes



# Corrections and guidance

- Bit-reversal UB lower bound (Prover 1): The argument via t = ν2(i−1) shows UB_i ≥ log(min{2^t, 2^{h−t−1}}) = min{t, h−t−1} − O(1). With Pr[t=k]=2^{−(k+1)}, we have E[min{t,h−t−1}] = ∑_{k=0}^{h−1} 2^{−(k+1)} min{k, h−k−1} = O(1). Therefore this line of reasoning yields only UB(π) = Ω(n), not Ω(n log n). The step claiming Θ(h) per step is incorrect.

- DFS UB = Θ(n) (Prover 1): The sketch using UB_i ≤ log(2 + |x_i − x_{i−1}|) is plausible but needs a clean proof. Suggested route: charge log differences to subtree sizes along the DFS traversal and show ∑_v O(log size(v)) = O(n).

- Round-robin block construction (Prover 2): The per-step lower bound min_j (j + |x_i − x_{i−j}|) ≥ ⌊b/2⌋ for all i beyond the first round is false. Counterexample pattern (general b): choose within-block σ_b with (c_2, c_3) = (1, b). For any block B_r at round t=3, let s be the adjacent block that comes after r in ρ_k. Then the last access to B_s was at round t=2 with key c_2=1, so Δ = b + c_2 − c_3 = 1. The corresponding j equals k + pos(r) − pos(s) − 1 ≤ k−1, hence j + Δ ≤ k. When k ≪ b, this is < b/2, contradicting the claimed bound. In fact, many t produce such small witnesses, so UB_i can be O(log k) frequently.

- Fractal 2413 family (Prover 1): BST side is promising if we can cite or prove that Greedy runs in O(n) on permutations whose substitution decomposition uses only simple nodes of size ≤ 4. The UB lower bound must be scale-based: for many i, show that all candidates among the last L (for L ≈ the size of a relevant block scale) are far in key, so min_j (j+Δ) = Ω(L), giving UB_i = Ω(log L). The naive “first-arrival per block” charge yields only O(n) total and is insufficient.

- Next steps:
  1) Provide a rigorous DFS UB=O(n) proof or a citation.
  2) Correct the bit-reversal UB claim; add numerical UB for n = 2^h up to h ≈ 14–16.
  3) For F_h, (a) verify/cite Greedy’s O(n) bound for k-decomposable (k=4), (b) develop and prove a proper scale-based UB lower bound, and (c) compute UB empirically for h up to 8–10.
  4) Abandon the round-robin block family for UB ≈ n log(n/k); its structure lets adjacent-block, previous-round witnesses keep UB_i = O(log k) too often.


New candidate family and fix to UB lower bound

- Adopt the recursively interleaved 2413-inflation family π_h on n=4^h keys with the midpoint-first constraint: at every interval J of size 4^t, the first key emitted by F_t(J) is the midpoint m(J); and at each node, the time order of children is 2,4,1,3.
- UB lower bound strategy: charge only at child-boundary steps within each node’s restricted sequence (S2→S4, S4→S1, S1→S3). At the first key of a child, all previous accesses are outside that child; the midpoint ensures a rank-distance ≥ s_v/8 to any earlier key, where s_v is the parent interval size. Thus UB_i ≥ log(1 + s_v/8) at those steps.
- Counting without double counting: each consecutive pair (x_{i−1}, x_i) has a unique lowest common ancestor v in the 4-ary decomposition tree; this pair coincides with exactly one such boundary at v. Hence the boundary times over all nodes are disjoint and total n−1.
- Summing over nodes gives UB(π_h) ≥ Θ(n log n); the trivial UB ≤ n log n yields UB(π_h) = Θ(n log n).
- BST side: choose a static reference BST that recursively splits {I1∪I2} vs {I3∪I4}. At each decomposition node, the restricted sequence is L,R,L,R, so exactly 3 alternations. Filling contiguous intervals into a full BST contributes O(1) alternations per filler node. Hence Wilber-1 = O(n). Tango yields an explicit algorithm with cost O(n log log n).
- Correction: The earlier per-level event argument (choosing t in the first quarter of D and claiming t−j lies in B for j ≤ s) is false; those t−j remain in D. The boundary/LCA charging avoids this pitfall.
- Next: formalize the LCA-based bijection and the filler-node alternation accounting; attempt to improve OPT to O(n) (Greedy or tailored BST).


=== Current Proofs ===

# Rigorous Proofs



Permutation family with UB = Θ(n log n) and OPT ≤ O(n log log n)

Definitions
- Let h ≥ 1 and n = 4^h. For any contiguous key interval I = [a..b] with |I| = 4^t, split I into four equal contiguous subintervals I1 < I2 < I3 < I4. Define m(I) := ⌊(a+b)/2⌋.
- Define recursively F_0(I) to be the unique element of I. For t ≥ 1, define F_t(I) to be the concatenation of the four subsequences S2 := F_{t−1}(I2), S4 := F_{t−1}(I4), S1 := F_{t−1}(I1), S3 := F_{t−1}(I3), with the inductive constraint that for every interval J of size 4^u, the first element of F_u(J) is m(J). This is consistent since F_{u−1}(Jk) begins with m(Jk).
- The permutation π_h is F_h([1..4^h]). Let T be the 4-ary decomposition tree whose nodes are the intervals I encountered by the recursion; each internal node v has an interval I_v of size s_v and children I_v(1)<I_v(2)<I_v(3)<I_v(4).
- For any internal node v, the restriction of π_h to keys in I_v is exactly S2 ∘ S4 ∘ S1 ∘ S3, where Sk lists all keys in I_v(k) and no other keys.

Lemma 1 (Midpoint separation). Let v be an internal node with interval size s_v and let k ∈ {1,2,3,4}. Let x be the first key of Sk in the restricted sequence at v. Then for any key y ∉ I_v(k), |x − y| ≥ s_v/8.
Proof. By construction, x = m(I_v(k)), the midpoint of the child interval I_v(k), whose length is s_v/4. The distance from the midpoint to any boundary of I_v(k) is s_v/8. If y lies in a sibling I_v(k′), the closest such y is at the boundary between I_v(k) and I_v(k′), hence |x−y| ≥ s_v/8. If y lies outside I_v, the closest such y is at a boundary of I_v, and the distance from x to that boundary is ≥ s_v/8 as well. ∎

Lemma 2 (Per-boundary UB). Let i be the global time index at which, within the restricted sequence for v, the traversal first enters child k (i.e., the boundary S?→Sk at v). Then UB_i(π_h) ≥ log(1 + s_v/8).
Proof. At time i there has been no prior access to any key in I_v(k) (the subsequence for I_v(k) occurs only within Sk and we are at the first element of Sk). Therefore every prior key y lies in I_v \ I_v(k) or outside I_v. By Lemma 1, for all prior y we have |x_i − y| ≥ s_v/8. Hence for all j ≤ i−1, j + |x_i − x_{i−j}| ≥ s_v/8. Taking logs gives the claim. ∎

Lemma 3 (Boundary–transition bijection). For each i ∈ {2,…,n}, let v(i) be the lowest (deepest) node in T whose children contain x_{i−1} and x_i in two different children; equivalently, v(i) is the lowest common ancestor (LCA) of the two leaves holding x_{i−1} and x_i. Then i is exactly one of the three child-boundary indices S2→S4, S4→S1, or S1→S3 within the restricted sequence at v(i). Moreover, the mapping i ↦ v(i) is a bijection between {2,…,n} and the multiset of all such boundaries over all internal nodes of T; in particular, the boundary indices over all nodes are pairwise distinct and their total number is n−1.
Proof. The restricted sequence at any internal node v is the concatenation S2 ∘ S4 ∘ S1 ∘ S3, with no interleaving between different children. For any consecutive pair (x_{i−1}, x_i), there is a unique lowest node v whose children separate the two keys; at all descendants of v, the two keys lie in different subtrees, and at all ancestors they lie in the same child. Thus within the restriction to I_v the pair occurs at a boundary between two consecutive child blocks, necessarily one of S2→S4, S4→S1, S1→S3. Distinct consecutive pairs have distinct LCAs, so the boundary indices are distinct across nodes. Counting gives exactly three boundaries per internal node and a total of (4^h−1) internal nodes divided by 3 levels in a full 4-ary tree, hence 3·|(internal nodes)| = 4^h − 1 = n − 1 boundaries, matching the number of consecutive pairs. ∎

Theorem 4 (UB lower bound). There exists a universal constant c > 0 such that UB(π_h) ≥ c · n · log n.
Proof. By Lemma 3, the n−1 consecutive-pair indices are partitioned by internal nodes v, three per node. For each such index i associated with v, Lemma 2 gives UB_i ≥ log(1 + s_v/8). Hence
UB(π_h) ≥ ∑_{v internal} 3 · log(1 + s_v/8).
At level ℓ = 0,1,…,h−1 (counting 0 at the root), there are 4^ℓ internal nodes each with s_v = 4^{h−ℓ}. Therefore
∑_{v internal} log(1 + s_v/8) ≥ ∑_{ℓ=0}^{h−1} 4^ℓ · ( (h−ℓ) · log 4 − O(1) ) = Θ( 4^h · h ) = Θ( n · log n ).
Multiplying by the constant factor 3 and adjusting constants yields UB(π_h) ≥ c n log n. ∎

Proposition 5 (Wilber-1 bound for a tailored reference tree). There exists a fixed static BST T_ref on [1..n] such that the Wilber-1 alternation bound W_1(T_ref, π_h) = O(n).
Construction and proof. Build T_ref recursively: for each internal node interval I_v, create a BST node that partitions keys into L_v := I_v(1) ∪ I_v(2) and R_v := I_v(3) ∪ I_v(4), and recurse on L_v and R_v. Complete this into a full BST by arbitrary binary splits inside the contiguous subintervals. For any decomposition node v, the sequence restricted to I_v visits L_v and R_v in the order L_v, R_v, L_v, R_v (since the child order is 2,4,1,3), yielding exactly 3 alternations at that partition. Each internal decomposition node thus contributes 3 alternations. The remaining filler nodes partition contiguous intervals that the sequence visits as a single block at that scale, hence each such node sees at most one alternation. Since the total number of nodes is O(n), W_1(T_ref, π_h) = O(n). ∎

Corollary 6 (BST upper bound). The Tango tree achieves cost O(W_1 · log log n) against any fixed reference tree. With T_ref from Proposition 5, there is an explicit BST algorithm whose total cost on π_h is O(n log log n). Therefore OPT_BST(π_h) ≤ O(n log log n).

Conclusion. Combining Theorem 4 with the trivial UB(π_h) ≤ n log(1+n) gives UB(π_h) = Θ(n log n). Together with Corollary 6 we obtain OPT_BST(π_h) = o(UB(π_h)), resolving the separation task (non-strong form).


=== Current Output ===

# Main Results



Result: An explicit permutation family with UB = Θ(n log n) and OPT_BST ≤ O(n log log n)

Setup
- Let n = 4^h. Define a permutation π_h by recursively partitioning [1..n] into four equal contiguous key blocks I1<I2<I3<I4. The time order at each node is 2,4,1,3 (2413 inflation). Impose the midpoint-first constraint: for every interval J of size 4^t, the first key emitted by its subsequence is the midpoint m(J).

Unified-bound lower bound
- For an internal node v with interval size s_v, at the time i when the sequence first enters a child block within v (i.e., at boundaries S2→S4, S4→S1, S1→S3), the accessed key x_i is the midpoint of that child. No earlier access lies in that child, hence every earlier key y is outside it. The midpoint is at rank-distance ≥ s_v/8 from any such y. Therefore UB_i ≥ log(1 + s_v/8).
- Each pair of consecutive accesses (x_{i−1}, x_i) has a unique lowest common ancestor v in the 4-ary decomposition tree; within v’s restricted sequence this pair occurs at one of the three child-boundaries. These boundary indices over all v are pairwise distinct and total n−1.
- Summing UB_i over these n−1 indices yields ∑_v 3·log(1 + s_v/8). There are 4^ℓ nodes at level ℓ with s_v = 4^{h−ℓ}; thus the sum is Θ(∑_{ℓ=0}^{h−1} 4^ℓ (h−ℓ)) = Θ(n log n). Since trivially UB(π_h) ≤ n log(1+n), we conclude UB(π_h) = Θ(n log n).

BST upper bound
- Fix a static reference BST T_ref that, at each node of the decomposition, splits keys into L := I1∪I2 and R := I3∪I4 and recurses; fill contiguous subintervals arbitrarily to form a full BST. For any decomposition node, the restricted sequence visits L and R in the pattern L,R,L,R, so exactly 3 alternations occur at that partition. Filler nodes on contiguous intervals contribute at most one alternation each. Hence Wilber-1(T_ref, π_h) = O(n).
- Tango trees achieve cost O(W_1 · log log n) against any fixed reference tree. Therefore there is an explicit BST algorithm with total cost O(n log log n) on π_h, implying OPT_BST(π_h) ≤ O(n log log n).

Conclusion
- The family {π_h} yields UB(π_h) = Θ(n log n) while OPT_BST(π_h) ≤ O(n log log n). Consequently OPT_BST(π_h) / UB(π_h) = O(log log n / log n) = o(1), providing the requested separation (not yet the strongest O(n) vs Ω(n log n)).