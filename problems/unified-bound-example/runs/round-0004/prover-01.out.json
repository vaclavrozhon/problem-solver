{
  "content": "# Goal\n\nExplain in detail the recursively interleaved 2413-inflation example, with (i) a rigorous Wilber-1 analysis showing small cost (O(n) alternations), and (ii) a correct unified-bound analysis. Conclusion: the Wilber-1 part is correct (thus Tango achieves O(n log log n)); the UB lower bound asserted in output.md is not correct as stated \u2014 the boundary charging yields only \u0398(n), not \u0398(n log n). I also supply a general O(n) upper bound on UB for this family (and any constant-arity hierarchical concatenation), and a separate lemma showing random permutations have UB = \u2126(n log n) in expectation (to calibrate what \u201clarge UB\u201d looks like).\n\n# The 2413-inflation family \u03c0_h (n = 4^h)\n\nDefinition.\n- Let the root interval be [1..n]. Recursively partition any interval J of size 4^t into 4 equal contiguous key blocks A(J) < B(J) < C(J) < D(J), each of size 4^{t\u22121}.\n- Time order at each node is 2413: we visit the child blocks in the order B, then D, then A, then C, and within each child we recurse identically.\n- Optionally (as in output.md), impose the midpoint-first constraint inside each child: within any interval K, the first key of its subsequence is the midpoint m(K). This helps express clean rank separations at boundaries; it does not affect the asymptotic conclusions below.\n\nThus the global order is a hierarchical concatenation (at every node, the restricted sequence is a concatenation of its children\u2019s sequences in the fixed order B D A C).\n\n# Wilber-1(T_ref, \u03c0_h) = \u0398(n)\n\nWe construct a fixed reference BST T_ref mirroring the 4-ary decomposition into three binary splits per 4-ary node.\n\nConstruction of T_ref at a node v with children A<B<C<D.\n- Create a binary node u_v that splits L := A\u222aB vs R := C\u222aD.\n- In u_v\u2019s left subtree, create a node splitting A vs B; in its right subtree, a node splitting C vs D.\n- Recurse inside A,B,C,D.\nThis yields a BST on [n] whose internal nodes correspond to the three \u201cadjacent-block\u201d splits at every 4-ary node, recursively.\n\nWilber-1 definition.\nFor any internal node w of a reference BST, let alt(w) be the number of alternations between accesses from its left vs right subtree, when we scan the sequence restricted to keys in w\u2019s subtree. Then W_1(T_ref, \u03c0_h) = \u2211_w alt(w).\n\nLemma 1 (alternations per 4-ary node are constant).\nFix a 4-ary node v with restricted sequence B | D | A | C (each a contiguous time block).\n- At u_v (split L vs R), the subsequence of sides is L, R, L, R; hence alt(u_v) = 3.\n- At the A-vs-B split (left child of u_v), the restricted sequence is B then A; alt = 1.\n- At the C-vs-D split (right child of u_v), the restricted sequence is D then C; alt = 1.\nNo deeper recursion can create more alternations at these three nodes, because within each of B,D,A,C all subsequent accesses remain on the same side of these splits.\n\nHence each 4-ary node contributes exactly 3+1+1 = 5 alternations, independent of block sizes.\n\nCounting nodes.\nA full 4-ary decomposition of n leaves (keys) has exactly (n\u22121)/3 internal 4-ary nodes. Each such node contributes three internal nodes to T_ref, but we have already accounted alternations per 4-ary node (5 total), so we need not count binary nodes separately.\n\nConclusion 1.\nW_1(T_ref, \u03c0_h) = 5 \u00b7 (n\u22121)/3 = \u0398(n).\n\nCorollary (algorithmic upper bound via Tango).\nThe Tango-tree bound gives a dynamic BST with total cost O(W_1(T_ref) \u00b7 log log n) = O(n log log n). Since you do not care about log log factors, this serves as an \u201cO(n)\u201d up to a very slowly growing factor. In particular OPT_BST(\u03c0_h) \u2264 O(n log log n).\n\n# Unified bound on \u03c0_h: the boundary-only lower bound gives \u0398(n), not \u0398(n log n)\n\nWe clarify the boundary-charging idea and its true consequence.\n\nAt any 4-ary node v with interval size s_v, the three child-boundary times in its restricted sequence are the first access into D (after finishing B), the first into A (after D), and the first into C (after A). If we impose midpoint-first within each child, then at each such boundary time i the accessed key x_i is the child midpoint; since no earlier access is in that child, every earlier key lies outside it and is at rank distance \u2265 s_v/8 from x_i. Hence\nUB_i(\u03c0_h) \u2265 log(1 + s_v/8)\nfor those three indices per v.\n\nThese boundary indices over all nodes are disjoint and exactly enumerate the n\u22121 consecutive-pair transitions (each pair\u2019s lowest common ancestor identifies a unique boundary). Therefore\n\u2211_{i=1}^n UB_i(\u03c0_h) \u2265 \u2211_{v internal} 3 \u00b7 log(1 + s_v/8).\nNow sum over all 4-ary nodes. Let s_v = 4^{h\u2212\u2113} for nodes at level \u2113, with 4^\u2113 such nodes. Then\n\u2211_{v internal} log(1 + s_v/8) = \u2211_{\u2113=0}^{h\u22121} 4^\u2113 \u00b7 \u0398(1 + h\u2212\u2113) = \u0398(4^h \u00b7 \u2211_{t=1}^{h} t/4^t) = \u0398(n).\nHence the boundary-only lower bound totals \u0398(n), not \u0398(n log n).\n\nConclusion 2.\nThe UB proof in output.md that summed boundary contributions to obtain \u0398(n log n) was incorrect; the correct total from such boundary terms is \u0398(n).\n\n# A general O(n) upper bound on UB for hierarchical concatenations\n\nWe now show that for any permutation built by recursive concatenation of a constant number b of contiguous subintervals at every node (in any fixed order), the unified bound is O(n). The 2413-inflation family is a special case with b=4.\n\nLet S(\u03c0) := \u2211_{i=2}^{n} log(2 + |x_i \u2212 x_{i\u22121}|). Note that for every i\u22652,\nUB_i(\u03c0) = log(1 + min_j (j + \u0394_i(j))) \u2264 log(1 + (1 + |x_i \u2212 x_{i\u22121}|)) \u2264 log(2 + |x_i \u2212 x_{i\u22121}|).\nHence UB(\u03c0) \u2264 S(\u03c0).\n\nWe will prove S(\u03c0) = O(n) by a decomposition recurrence.\n\nConsider any internal node v with interval I_v (|I_v| = m) and children v_1,\u2026,v_b with contiguous intervals partitioning I_v. Let \u03c0(v) denote the subsequence restricted to I_v, which is the concatenation \u03c0(v_\u03c3(1)) \u22ef \u03c0(v_\u03c3(b)) for some order \u03c3 of the children.\n\nThen the sum S restricted to pairs inside \u03c0(v) satisfies the exact decomposition\nS(\u03c0(v)) = \u2211_{k=1}^{b} S(\u03c0(v_\u03c3(k))) + \u2211_{p=1}^{b\u22121} log(2 + |last(v_\u03c3(p)) \u2212 first(v_\u03c3(p+1))|),\nwhere last(\u00b7) and first(\u00b7) denote the last and first keys of the child-blocks in time. Since those two keys lie in adjacent child intervals inside I_v, their rank distance is at most m. Therefore each boundary term is \u2264 log(2 + m), and there are b\u22121 such terms. Thus\nS(\u03c0(v)) \u2264 \u2211_{k=1}^{b} S(\u03c0(v_k)) + (b\u22121) \u00b7 log(2 + m).\nAt leaves (single keys) we have S = 0. Summing this recurrence over the decomposition tree yields\nS(\u03c0) \u2264 \u2211_{v internal} (b\u22121) \u00b7 log(2 + |I_v|).\nIt remains to bound the last sum by O(n) for constant b.\n\nLemma 3 (size-bucketing bound).\nLet \ud835\udcaf be any rooted tree whose nodes are disjoint contiguous subintervals of [1..n], with the root being [1..n] and children partitioning the parent\u2019s interval. Then\n\u2211_{v\u2208\ud835\udcaf, v internal} log(2 + |I_v|) = O(n).\nProof. Partition internal nodes into size classes \ud835\udc9e_k := { v : 2^k \u2264 |I_v| < 2^{k+1} }. Intervals in each class are disjoint and lie in [1..n], so |\ud835\udc9e_k| \u2264 n/2^k. Then\n\u2211_{v internal} log(2 + |I_v|) \u2264 \u2211_{k=0}^{\u230alog_2 n\u230b} |\ud835\udc9e_k| \u00b7 log(2^{k+1}+2) \u2264 \u2211_{k=0}^{\u230alog_2 n\u230b} (n/2^k) \u00b7 O(k+1) = O(n \u00b7 \u2211_{k\u22650} (k+1)/2^k) = O(n).\n\nCombining the recurrence with Lemma 3 gives S(\u03c0) = O(n). Since UB(\u03c0) \u2264 S(\u03c0), we conclude\n\nTheorem 4.\nFor any hierarchical concatenation permutation with constant branching b (including the 2413-inflation family), UB(\u03c0) = O(n).\n\nIn particular, for \u03c0_h, UB(\u03c0_h) = O(n).\n\n# Calibrating \u201clarge UB\u201d: random permutations have UB = \u2126(n log n)\n\nTo see what structures force large unified bound, consider a uniform random permutation \u03c0 on [n]. We prove a simple \u2126(n log n) expected lower bound.\n\nLemma 5 (window emptiness with constant probability). Fix i \u2265 n/2. Let t := \u230a\u221an\u230b and r := \u230a\u03b1\u00b7n/t\u230b for a small constant \u03b1\u2208(0,1/8). Conditioned on x_i, the previous t accesses are t distinct uniformly random keys from [n] \\ {x_1,\u2026,x_{i\u2212t\u22121}}. The probability that none of them lies in the rank window [x_i\u2212r, x_i+r] is\n\u2265 ((n\u22121\u22122r) choose t)/((n\u22121) choose t) \u2265 (1 \u2212 2r/(n\u22121))^t \u2265 exp(\u22124\u03b1 + o(1)) =: p_0 > 0.\n\nLemma 6 (UB_i given window emptiness).\nOn the event of Lemma 5, for j \u2264 t we have \u0394_i(j) \u2265 r, hence j + \u0394_i(j) \u2265 r; for j > t we have j \u2265 t. Thus min_j (j + \u0394_i(j)) \u2265 min{ r, t } \u2265 c\u00b7\u221an for some c>0. Therefore UB_i \u2265 (1/2) log n \u2212 O(1).\n\nTheorem 7.\nE[UB(\u03c0)] \u2265 c\u2032 n log n for some c\u2032>0.\nProof. By Lemmas 5\u20136, for every i in the last n/2 positions we have E[UB_i] \u2265 p_0 \u00b7 ((1/2) log n \u2212 O(1)). Summing over \u2126(n) such i yields the claim.\n\nThis shows UB can be as large as \u0398(n log n) on some permutations. However, such permutations also tend to have large Wilber-1 under any fixed reference tree (indeed W_1 is \u0398(n log n) for random permutations with high probability), so they do not give the desired small-BST-cost example.\n\n# Conclusions and guidance\n\n- The 2413-inflation example from output.md: the Wilber-1 analysis is valid and yields W_1(T_ref, \u03c0_h) = \u0398(n), hence Tango-cost O(n log log n). However, the unified-bound lower bound there is incorrect; the boundary-charging argument gives only \u0398(n), and in fact the general hierarchical-concatenation structure forces UB(\u03c0_h) = O(n). Thus this family does not provide the desired UB \u226b OPT separation.\n- To obtain UB = \u2126(n log n), one needs substantial interleaving across scales so that many accesses lack nearby-in-key recent witnesses. But such interleaving also increases alternations at many reference-tree splits, driving Wilber-1 up. Designing a family with simultaneously UB = \u2126(n log n) and W_1(T_ref) = O(n) remains open here and appears delicate.\n\n# Next steps\n\n- If you accept Wilber-1 as the \u201csmall cost\u201d certificate (ignoring log log factors), then any future candidate family must satisfy: (i) a rigorous UB lower bound of \u2126(n log n) (likely via a more global, scale-sensitive argument: for a constant fraction of i, all j up to a scale L have large \u0394), and (ii) for some fixed reference tree T_ref, alternations per node are O(1), giving W_1(T_ref) = O(n). The 2413-inflation family satisfies (ii) but fails (i).\n- Alternatively, we can pursue a formal impossibility: prove that any permutation with W_1(T_ref) = O(n) on some tree T_ref must have UB = O(n). The hierarchical concatenation argument suggests such a principle might hold for a natural class (decomposable permutations with constant arity at all scales), which would definitively rule out this approach and narrow the search space.\n\nI can formalize any of the above proofs (Wilber-1 = \u0398(n), UB = O(n) for concatenations, UB = \u2126(n log n) for random) into proofs.md on request."
}