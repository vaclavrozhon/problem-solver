# Goal

Explain in detail the recursively interleaved 2413-inflation example, with (i) a rigorous Wilber-1 analysis showing small cost (O(n) alternations), and (ii) a correct unified-bound analysis. Conclusion: the Wilber-1 part is correct (thus Tango achieves O(n log log n)); the UB lower bound asserted in output.md is not correct as stated ‚Äî the boundary charging yields only Œò(n), not Œò(n log n). I also supply a general O(n) upper bound on UB for this family (and any constant-arity hierarchical concatenation), and a separate lemma showing random permutations have UB = ‚Ñ¶(n log n) in expectation (to calibrate what ‚Äúlarge UB‚Äù looks like).

# The 2413-inflation family œÄ_h (n = 4^h)

Definition.
- Let the root interval be [1..n]. Recursively partition any interval J of size 4^t into 4 equal contiguous key blocks A(J) < B(J) < C(J) < D(J), each of size 4^{t‚àí1}.
- Time order at each node is 2413: we visit the child blocks in the order B, then D, then A, then C, and within each child we recurse identically.
- Optionally (as in output.md), impose the midpoint-first constraint inside each child: within any interval K, the first key of its subsequence is the midpoint m(K). This helps express clean rank separations at boundaries; it does not affect the asymptotic conclusions below.

Thus the global order is a hierarchical concatenation (at every node, the restricted sequence is a concatenation of its children‚Äôs sequences in the fixed order B D A C).

# Wilber-1(T_ref, œÄ_h) = Œò(n)

We construct a fixed reference BST T_ref mirroring the 4-ary decomposition into three binary splits per 4-ary node.

Construction of T_ref at a node v with children A<B<C<D.
- Create a binary node u_v that splits L := A‚à™B vs R := C‚à™D.
- In u_v‚Äôs left subtree, create a node splitting A vs B; in its right subtree, a node splitting C vs D.
- Recurse inside A,B,C,D.
This yields a BST on [n] whose internal nodes correspond to the three ‚Äúadjacent-block‚Äù splits at every 4-ary node, recursively.

Wilber-1 definition.
For any internal node w of a reference BST, let alt(w) be the number of alternations between accesses from its left vs right subtree, when we scan the sequence restricted to keys in w‚Äôs subtree. Then W_1(T_ref, œÄ_h) = ‚àë_w alt(w).

Lemma 1 (alternations per 4-ary node are constant).
Fix a 4-ary node v with restricted sequence B | D | A | C (each a contiguous time block).
- At u_v (split L vs R), the subsequence of sides is L, R, L, R; hence alt(u_v) = 3.
- At the A-vs-B split (left child of u_v), the restricted sequence is B then A; alt = 1.
- At the C-vs-D split (right child of u_v), the restricted sequence is D then C; alt = 1.
No deeper recursion can create more alternations at these three nodes, because within each of B,D,A,C all subsequent accesses remain on the same side of these splits.

Hence each 4-ary node contributes exactly 3+1+1 = 5 alternations, independent of block sizes.

Counting nodes.
A full 4-ary decomposition of n leaves (keys) has exactly (n‚àí1)/3 internal 4-ary nodes. Each such node contributes three internal nodes to T_ref, but we have already accounted alternations per 4-ary node (5 total), so we need not count binary nodes separately.

Conclusion 1.
W_1(T_ref, œÄ_h) = 5 ¬∑ (n‚àí1)/3 = Œò(n).

Corollary (algorithmic upper bound via Tango).
The Tango-tree bound gives a dynamic BST with total cost O(W_1(T_ref) ¬∑ log log n) = O(n log log n). Since you do not care about log log factors, this serves as an ‚ÄúO(n)‚Äù up to a very slowly growing factor. In particular OPT_BST(œÄ_h) ‚â§ O(n log log n).

# Unified bound on œÄ_h: the boundary-only lower bound gives Œò(n), not Œò(n log n)

We clarify the boundary-charging idea and its true consequence.

At any 4-ary node v with interval size s_v, the three child-boundary times in its restricted sequence are the first access into D (after finishing B), the first into A (after D), and the first into C (after A). If we impose midpoint-first within each child, then at each such boundary time i the accessed key x_i is the child midpoint; since no earlier access is in that child, every earlier key lies outside it and is at rank distance ‚â• s_v/8 from x_i. Hence
UB_i(œÄ_h) ‚â• log(1 + s_v/8)
for those three indices per v.

These boundary indices over all nodes are disjoint and exactly enumerate the n‚àí1 consecutive-pair transitions (each pair‚Äôs lowest common ancestor identifies a unique boundary). Therefore
‚àë_{i=1}^n UB_i(œÄ_h) ‚â• ‚àë_{v internal} 3 ¬∑ log(1 + s_v/8).
Now sum over all 4-ary nodes. Let s_v = 4^{h‚àí‚Ñì} for nodes at level ‚Ñì, with 4^‚Ñì such nodes. Then
‚àë_{v internal} log(1 + s_v/8) = ‚àë_{‚Ñì=0}^{h‚àí1} 4^‚Ñì ¬∑ Œò(1 + h‚àí‚Ñì) = Œò(4^h ¬∑ ‚àë_{t=1}^{h} t/4^t) = Œò(n).
Hence the boundary-only lower bound totals Œò(n), not Œò(n log n).

Conclusion 2.
The UB proof in output.md that summed boundary contributions to obtain Œò(n log n) was incorrect; the correct total from such boundary terms is Œò(n).

# A general O(n) upper bound on UB for hierarchical concatenations

We now show that for any permutation built by recursive concatenation of a constant number b of contiguous subintervals at every node (in any fixed order), the unified bound is O(n). The 2413-inflation family is a special case with b=4.

Let S(œÄ) := ‚àë_{i=2}^{n} log(2 + |x_i ‚àí x_{i‚àí1}|). Note that for every i‚â•2,
UB_i(œÄ) = log(1 + min_j (j + Œî_i(j))) ‚â§ log(1 + (1 + |x_i ‚àí x_{i‚àí1}|)) ‚â§ log(2 + |x_i ‚àí x_{i‚àí1}|).
Hence UB(œÄ) ‚â§ S(œÄ).

We will prove S(œÄ) = O(n) by a decomposition recurrence.

Consider any internal node v with interval I_v (|I_v| = m) and children v_1,‚Ä¶,v_b with contiguous intervals partitioning I_v. Let œÄ(v) denote the subsequence restricted to I_v, which is the concatenation œÄ(v_œÉ(1)) ‚ãØ œÄ(v_œÉ(b)) for some order œÉ of the children.

Then the sum S restricted to pairs inside œÄ(v) satisfies the exact decomposition
S(œÄ(v)) = ‚àë_{k=1}^{b} S(œÄ(v_œÉ(k))) + ‚àë_{p=1}^{b‚àí1} log(2 + |last(v_œÉ(p)) ‚àí first(v_œÉ(p+1))|),
where last(¬∑) and first(¬∑) denote the last and first keys of the child-blocks in time. Since those two keys lie in adjacent child intervals inside I_v, their rank distance is at most m. Therefore each boundary term is ‚â§ log(2 + m), and there are b‚àí1 such terms. Thus
S(œÄ(v)) ‚â§ ‚àë_{k=1}^{b} S(œÄ(v_k)) + (b‚àí1) ¬∑ log(2 + m).
At leaves (single keys) we have S = 0. Summing this recurrence over the decomposition tree yields
S(œÄ) ‚â§ ‚àë_{v internal} (b‚àí1) ¬∑ log(2 + |I_v|).
It remains to bound the last sum by O(n) for constant b.

Lemma 3 (size-bucketing bound).
Let ùíØ be any rooted tree whose nodes are disjoint contiguous subintervals of [1..n], with the root being [1..n] and children partitioning the parent‚Äôs interval. Then
‚àë_{v‚ààùíØ, v internal} log(2 + |I_v|) = O(n).
Proof. Partition internal nodes into size classes ùíû_k := { v : 2^k ‚â§ |I_v| < 2^{k+1} }. Intervals in each class are disjoint and lie in [1..n], so |ùíû_k| ‚â§ n/2^k. Then
‚àë_{v internal} log(2 + |I_v|) ‚â§ ‚àë_{k=0}^{‚åälog_2 n‚åã} |ùíû_k| ¬∑ log(2^{k+1}+2) ‚â§ ‚àë_{k=0}^{‚åälog_2 n‚åã} (n/2^k) ¬∑ O(k+1) = O(n ¬∑ ‚àë_{k‚â•0} (k+1)/2^k) = O(n).

Combining the recurrence with Lemma 3 gives S(œÄ) = O(n). Since UB(œÄ) ‚â§ S(œÄ), we conclude

Theorem 4.
For any hierarchical concatenation permutation with constant branching b (including the 2413-inflation family), UB(œÄ) = O(n).

In particular, for œÄ_h, UB(œÄ_h) = O(n).

# Calibrating ‚Äúlarge UB‚Äù: random permutations have UB = ‚Ñ¶(n log n)

To see what structures force large unified bound, consider a uniform random permutation œÄ on [n]. We prove a simple ‚Ñ¶(n log n) expected lower bound.

Lemma 5 (window emptiness with constant probability). Fix i ‚â• n/2. Let t := ‚åä‚àön‚åã and r := ‚åäŒ±¬∑n/t‚åã for a small constant Œ±‚àà(0,1/8). Conditioned on x_i, the previous t accesses are t distinct uniformly random keys from [n] \ {x_1,‚Ä¶,x_{i‚àít‚àí1}}. The probability that none of them lies in the rank window [x_i‚àír, x_i+r] is
‚â• ((n‚àí1‚àí2r) choose t)/((n‚àí1) choose t) ‚â• (1 ‚àí 2r/(n‚àí1))^t ‚â• exp(‚àí4Œ± + o(1)) =: p_0 > 0.

Lemma 6 (UB_i given window emptiness).
On the event of Lemma 5, for j ‚â§ t we have Œî_i(j) ‚â• r, hence j + Œî_i(j) ‚â• r; for j > t we have j ‚â• t. Thus min_j (j + Œî_i(j)) ‚â• min{ r, t } ‚â• c¬∑‚àön for some c>0. Therefore UB_i ‚â• (1/2) log n ‚àí O(1).

Theorem 7.
E[UB(œÄ)] ‚â• c‚Ä≤ n log n for some c‚Ä≤>0.
Proof. By Lemmas 5‚Äì6, for every i in the last n/2 positions we have E[UB_i] ‚â• p_0 ¬∑ ((1/2) log n ‚àí O(1)). Summing over ‚Ñ¶(n) such i yields the claim.

This shows UB can be as large as Œò(n log n) on some permutations. However, such permutations also tend to have large Wilber-1 under any fixed reference tree (indeed W_1 is Œò(n log n) for random permutations with high probability), so they do not give the desired small-BST-cost example.

# Conclusions and guidance

- The 2413-inflation example from output.md: the Wilber-1 analysis is valid and yields W_1(T_ref, œÄ_h) = Œò(n), hence Tango-cost O(n log log n). However, the unified-bound lower bound there is incorrect; the boundary-charging argument gives only Œò(n), and in fact the general hierarchical-concatenation structure forces UB(œÄ_h) = O(n). Thus this family does not provide the desired UB ‚â´ OPT separation.
- To obtain UB = ‚Ñ¶(n log n), one needs substantial interleaving across scales so that many accesses lack nearby-in-key recent witnesses. But such interleaving also increases alternations at many reference-tree splits, driving Wilber-1 up. Designing a family with simultaneously UB = ‚Ñ¶(n log n) and W_1(T_ref) = O(n) remains open here and appears delicate.

# Next steps

- If you accept Wilber-1 as the ‚Äúsmall cost‚Äù certificate (ignoring log log factors), then any future candidate family must satisfy: (i) a rigorous UB lower bound of ‚Ñ¶(n log n) (likely via a more global, scale-sensitive argument: for a constant fraction of i, all j up to a scale L have large Œî), and (ii) for some fixed reference tree T_ref, alternations per node are O(1), giving W_1(T_ref) = O(n). The 2413-inflation family satisfies (ii) but fails (i).
- Alternatively, we can pursue a formal impossibility: prove that any permutation with W_1(T_ref) = O(n) on some tree T_ref must have UB = O(n). The hierarchical concatenation argument suggests such a principle might hold for a natural class (decomposable permutations with constant arity at all scales), which would definitively rule out this approach and narrow the search space.

I can formalize any of the above proofs (Wilber-1 = Œò(n), UB = O(n) for concatenations, UB = ‚Ñ¶(n log n) for random) into proofs.md on request.